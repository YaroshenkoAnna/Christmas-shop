(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();const $="_container_1bv8m_5",x={container:$};class g{children=[];_subscriptions=[];get node(){return this._element}addClasses(e){e&&e.length>0&&this._element.classList.add(...e)}removeClasses(e){e&&e.length>0&&this._element.classList.remove(...e)}toggleClass(e){e&&this._element.classList.toggle(e)}setAttributes(e){if(e)for(const[t,s]of Object.entries(e))s&&this._element.setAttribute(t,s)}getAttribute(e){return this._element.getAttribute(e)}removeAttribute(e){this._element.removeAttribute(e)}appendChildren(...e){for(const t of e)t instanceof g?(this._element.append(t.node),this.children=[...this.children,t]):t instanceof Node&&this._element.append(t)}deleteChildren(){for(this.children.map(e=>{e.deleteElement()}),this.children=[];this._element.firstChild;)this._element.firstChild.remove()}deleteElement(){this.deleteChildren(),this.unsubscribeAll(),this._element.remove()}sub(...e){e.forEach(t=>{this._subscriptions.push(t)})}unsubscribeAll(){this._subscriptions.forEach(e=>{e()})}addListener(e,t){this._element.addEventListener(e,t)}removeListener(e,t){this._element.removeEventListener(e,t)}dispatchEvent(e,t){const s=new CustomEvent(e,{detail:t});this._element.dispatchEvent(s)}}class i extends g{_element;constructor(e){super(),this._element=document.createElement(e.tag),e&&(this.addClasses(e.classNames),this.setText(e.text),this.setAttributes(e.attributes))}setText(e){e&&(this._element.textContent=e)}}class b extends i{constructor(e){super({tag:"button",text:e.text,classNames:e.classNames,attributes:e.attributes}),this.addListener("click",e.callback)}disable(){this.setAttributes({disabled:"true"})}enable(){this.removeAttribute("disabled")}setDisabled(e){e?this.disable():this.enable()}}class N{listeners=new Set;emit(e){for(const t of this.listeners)t(e)}subscribe(e){return this.listeners.add(e),this.unsubscribe.bind(this,e)}unsubscribe(e){this.listeners.delete(e)}}class u extends N{constructor(e){super(),this._value=e}get value(){return this._value}set(e){this._value=e,this.emit(this._value)}update(e){this._value=e(this._value),this.emit(this._value)}subscribeAndGet(e){return e(this._value),this.subscribe(e)}}const P="_error_173rj_1",v={error:P,"error-message":"_error-message_173rj_8"};class _ extends i{value$=new u("");errorMessage=new i({tag:"label",classNames:[v["error-message"]]});constructor(e){super({tag:"input",classNames:e.classNames,text:e.text,attributes:e.attributes}),this.setType(e.type),this.addListener("input",()=>{this.value$.set(this.value)})}get value(){return this._element.value}set value(e){this._element.value=e,this.value$.set(e)}disable(){this._element.setAttribute("disabled","true")}enable(){this._element.removeAttribute("disabled")}setType(e){this._element.setAttribute("type",e)}observe(e){return this.value$.subscribeAndGet(e)}showErrors(e){this.errorMessage.deleteElement(),this._element.classList.toggle(v.error,e.length>0),e.length>0&&(this._element.parentElement?.appendChild(this.errorMessage.node),this.errorMessage.setText(e.join(`
`)))}}const A="_main_japez_1",R="_form_japez_12",S="_fieldset_japez_19",k="_label_japez_32",I="_input_japez_25",o={main:A,form:R,fieldset:S,"input-container":"_input-container_japez_25",label:k,input:I};class M extends i{formVM;loginVM;form=new i({tag:"form",classNames:[o.form]});fieldset=new i({tag:"fieldset",classNames:[o.fieldset]});legend=new i({tag:"legend",text:"Authorization"});loginContainer=new i({tag:"div",classNames:[o["input-container"]]});loginLabel=new i({tag:"label",classNames:[o.label],text:"Login"});passwordLabel=new i({tag:"label",classNames:[o.label],text:"Password"});passwordContainer=new i({tag:"div",classNames:[o["input-container"]]});loginInput=new _({type:"text",classNames:[o.input],attributes:{id:"name",placeholder:"Enter your name"}});passwordInput=new _({type:"password",classNames:[o.input],attributes:{id:"password",placeholder:"Enter password"}});submitButton=new b({text:"Submit",attributes:{type:"submit"},callback:()=>this.onSubmit()});infoButton=new b({text:"Info",callback:()=>{globalThis.location.hash="/info"}});constructor(e,t){super({tag:"main",classNames:[o.main]}),this.formVM=t,this.loginVM=e,this.render(),this.bind()}render(){this.appendChildren(this.form),this.form.appendChildren(this.fieldset,this.submitButton,this.infoButton),this.fieldset.appendChildren(this.legend,this.loginContainer,this.passwordContainer),this.loginContainer.appendChildren(this.loginLabel,this.loginInput),this.passwordContainer.appendChildren(this.passwordLabel,this.passwordInput)}bind(){this.formVM.isFormValid$.subscribe(e=>{this.submitButton.setDisabled?.(!e)}),this.loginInput.observe(e=>{this.formVM.setLogin(e),this.loginInput.showErrors(this.formVM.getLoginErrors())}),this.passwordInput.observe(e=>{this.formVM.setPassword(e),this.passwordInput.showErrors(this.formVM.getPasswordErrors())})}async onSubmit(){const e=await this.loginVM.submit(this.loginInput.value,this.passwordInput.value);e&&console.log(e)}}class U extends i{constructor(){super({tag:"main"}),this.render()}render(){}}const V="_main_15ht6_1",O="_title_15ht6_12",d={main:V,title:O};class T extends i{defaultRoute;constructor(e){super({tag:"main",classNames:[d.main]}),this.defaultRoute=e,this.render()}render(){const e=new i({tag:"h1",classNames:[d.title],text:"Fun Chat"}),t=new i({tag:"p",classNames:[d.paragraph],text:"Fun Chat is a chat application that allows you to communicate with your friends and family in real-time."}),s=new i({tag:"a",classNames:[d.link],text:"Author Anna Yaroshenko",attributes:{href:"https://github.com/YaroshenkoAnna"}}),r=new b({text:"Return",classNames:[d.button],callback:()=>{globalThis.location.hash=this.defaultRoute}});this.appendChildren(e,t,s,r)}}const F="_image_5475x_1",j={image:F};class z extends i{constructor(){super({tag:"main"}),this.render()}render(){const e=new i({tag:"img",classNames:[j.image],attributes:{src:"./error.png",alt:"error image"}});this.appendChildren(e)}}class B{constructor(e){this.storage=e}get(e){const t=this.storage.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return null}}set(e,t){this.storage.setItem(e,JSON.stringify(t))}remove(e){this.storage.removeItem(e)}}const p="user";class G{currentUser$=new u(null);storage;constructor(e){this.storage=e;const t=this.storage.get(p);t?.isLogined&&this.currentUser$.set(t)}setUser(e){this.currentUser$.set(e),this.storage.set(p,e)}clear(){this.currentUser$.set(null),this.storage.remove(p)}get isAuthenticated(){return!!this.currentUser$.value?.isLogined}}const D=new B(sessionStorage),w=new G(D);class Y{constructor(e){this.authService=e}router=null;async submit(e,t){try{const s=await this.authService.login(e,t);return s.isLogined&&this.router?(w.setUser(s),this.router.navigate("/main"),null):"Error"}catch(s){return typeof s=="string"?s:"Server error"}}setRouter(e){this.router=e}}class J{passwordErrors=[];loginErrors=[];validateForm(e,t){return this.validateLogin(e)&&this.validatePassword(t)}validatePassword(e){this.passwordErrors=[];const t=6,s=20,r=/[A-Z]/.test(e),a=/[a-z]/.test(e),h=/\d/.test(e),m=[{condition:e.length<t,message:`Password must be at least ${t} characters.`},{condition:e.length>s,message:`Password must be no more than ${s} characters.`},{condition:!a||!r||!h,message:"Password must contain at least one uppercase, one lowercase letter  and one number."}];for(const l of m)l.condition&&this.passwordErrors.push(l.message);return this.passwordErrors.length===0}validateLogin(e){this.loginErrors=[];const t=4,s=15;return e.length<t&&this.loginErrors.push(`Login must be at least ${t} characters.`),e.length>s&&this.loginErrors.push(`Login must be no more than ${s} characters.`),this.loginErrors.length===0}}class q{login$=new u("");password$=new u("");isFormValid$=new u(!1);validator=new J;constructor(){this.login$.subscribe(()=>this.validate()),this.password$.subscribe(()=>this.validate())}setLogin(e){this.login$.set(e)}setPassword(e){this.password$.set(e)}getLoginErrors(){return this.validator.validateLogin(this.login$.value),this.validator.loginErrors}getPasswordErrors(){return this.validator.validatePassword(this.password$.value),this.validator.passwordErrors}validate(){const e=this.validator.validateForm(this.login$.value,this.password$.value);this.isFormValid$.set(e)}}function K(){return self.crypto.randomUUID()}class W{constructor(e){this.client=e}login(e,t){return new Promise((s,r)=>{const a=K(),h=this.client.on("USER_LOGIN",l=>{l.id===a&&(h(),s(l.payload.user))}),m=this.client.on("ERROR",l=>{l.id===a&&(m(),r(l.payload.error))});this.client.send({id:a,type:"USER_LOGIN",payload:{user:{login:e,password:t}}})})}}const Z="ws://localhost:4000";class H{constructor(e=Z){this.url=e,this.connect()}socket=null;isConnected$=new u(!1);messageListeners=new Map;connect(){this.socket=new WebSocket(this.url),this.socket.addEventListener("open",()=>{this.isConnected$.set(!0)}),this.socket.addEventListener("close",()=>{this.isConnected$.set(!1),setTimeout(()=>this.connect(),5e3)}),this.socket.addEventListener("message",e=>{const t=JSON.parse(e.data);this.messageListeners.get(t.type)?.forEach(s=>s(t))})}send(e){this.socket?.send(JSON.stringify(e))}on(e,t){return this.messageListeners.has(e)||this.messageListeners.set(e,[]),this.messageListeners.get(e).push(t),()=>{const s=this.messageListeners.get(e);this.messageListeners.set(e,s.filter(r=>r!==t))}}}const E="/login",Q="/error";class X{formVM=new q;socket=new H;authService=new W(this.socket);createLoginPage(e){const t=new Y(this.authService);return t.setRouter(e),new M(t,this.formVM)}createMainPage(){return new U}createInfoPage(){return new T(E)}createErrorPage(){return new z}getSocket(){return this.socket}}function ee(n){return[{path:"/login",page:async e=>w.isAuthenticated?(e.navigate("/main",!0),new i({tag:"main"})):n.createLoginPage(e)},{path:"/main",page:async e=>w.isAuthenticated?n.createMainPage():(e.navigate("/login",!0),new i({tag:"main"}))},{path:"/info",page:()=>Promise.resolve(n.createInfoPage())},{path:"/error",page:()=>Promise.resolve(n.createErrorPage())}]}class te{routes;outlet;defaultRoute;errorRoute;constructor(e,t,s,r){this.routes=e,this.outlet=t,this.defaultRoute=s,this.errorRoute=r,globalThis.addEventListener("hashchange",()=>{this.loadRoute()}),globalThis.location.hash===""?this.navigate(this.defaultRoute):this.loadRoute()}async loadRoute(){const t=globalThis.location.hash.replace(/^#\/?/,"/"),s=this.routes.find(r=>r.path===t)||this.routes.find(r=>r.path===this.errorRoute);if(s){const r=await s.page(this);this.outlet.node.replaceChildren(r.node)}else console.error(`Route for path ${t} not found.`)}navigate(e,t=!1){const s=`#/${e.replace(/^\/+/,"")}`;t?globalThis.history.replaceState(null,"",s):globalThis.location.hash=s}}const se="_overlay_1yp9u_1",re="_spinner_1yp9u_14",f={overlay:se,spinner:re};class ne extends i{constructor(){super({tag:"div",classNames:[f.overlay]}),this.render()}render(){const e=new i({tag:"div",classNames:[f.spinner]}),t=new i({tag:"p",classNames:[f.text],text:"Connecting..."});this.appendChildren(e,t)}}class L extends g{_element;constructor(e){super(),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.classNames&&this.addClasses(e.classNames),this.setAttributes(e.attributes);const t=document.createElementNS("http://www.w3.org/2000/svg","use");t.setAttribute("href",e.href),this.appendChildren(t)}}class ie extends i{constructor(){super({tag:"footer"}),this.render()}render(){const e=new i({tag:"a",attributes:{href:"https://rs.school/"}}),t=new L({href:"./sprite.svg#rss",attributes:{width:"100",height:"36",fill:"black"}});e.appendChildren(t);const s=new i({tag:"a",attributes:{href:"https://github.com/YaroshenkoAnna"}}),r=new L({href:"./sprite.svg#git",attributes:{width:"36",height:"36",fill:"black"}});s.appendChildren(r);const a=new i({tag:"p",text:"2025 © Anna Yaroshenko"});this.appendChildren(e,s,a)}}const y=new i({tag:"div",classNames:[x.container]}),ae=new ie;document.body.append(y.node,ae.node);const C=new X;new te(ee(C),y,E,Q);const oe=C.getSocket();let c=null;oe.isConnected$.subscribeAndGet(n=>{!n&&!c&&(c=new ne,document.body.appendChild(c.node)),n&&c&&(c.deleteElement(),c=null)});
