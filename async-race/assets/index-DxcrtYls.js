(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}})();class p{children=[];_subscriptions=[];get node(){return this._element}addClasses(t){t&&t.length>0&&this._element.classList.add(...t)}removeClasses(t){t&&t.length>0&&this._element.classList.remove(...t)}toggleClass(t){t&&this._element.classList.toggle(t)}setAttributes(t){if(t)for(const[e,s]of Object.entries(t))s&&this._element.setAttribute(e,s)}getAttribute(t){return this._element.getAttribute(t)}removeAttribute(t){this._element.removeAttribute(t)}appendChildren(...t){for(const e of t)e instanceof p?(this._element.append(e.node),this.children=[...this.children,e]):e instanceof Node&&this._element.append(e)}deleteChildren(){for(this.children.map(t=>{t.deleteElement()}),this.children=[];this._element.firstChild;)this._element.firstChild.remove()}deleteElement(){this.deleteChildren(),this.unsubscribeAll(),this._element.remove()}sub(...t){t.forEach(e=>{this._subscriptions.push(e)})}unsubscribeAll(){this._subscriptions.forEach(t=>{t()})}addListener(t,e,s=!1){this._element.addEventListener(t,e,s)}removeListener(t,e,s=!1){this._element.removeEventListener(t,e,s)}dispatchEvent(t,e){const s=new CustomEvent(t,{detail:e});this._element.dispatchEvent(s)}}class i extends p{_element;constructor(t){super(),this._element=document.createElement(t.tag),t&&(this.addClasses(t.classNames),this.setText(t.text),this.setAttributes(t.attributes))}setText(t){t&&(this._element.textContent=t)}}const $="_button_1z0wj_1",R={button:$};class c extends i{constructor(t){super({tag:"button",classNames:[...t.classNames??[],R.button],text:t.text}),this.addListener("click",t.callback)}disable(){this.setAttributes({disabled:"true"})}enable(){this.removeAttribute("disabled")}setDisabled(t){t?this.disable():this.enable()}}class T extends i{garageButton;winnersButton;constructor(){super({tag:"nav"}),this.garageButton=new c({text:"Garage",callback:()=>{globalThis.location.hash="/garage"}}),this.winnersButton=new c({text:"Winners",callback:()=>{globalThis.location.hash="/winners"}}),this.garageButton.setAttributes({disabled:"true"}),this.appendChildren(this.garageButton,this.winnersButton),globalThis.addEventListener("hashchange",()=>this.updateButtonState())}updateButtonState(){const t=globalThis.location.hash;t==="#/garage"?(this.garageButton.setAttributes({disabled:"true"}),this.winnersButton.removeAttribute("disabled")):t==="#/winners"&&(this.winnersButton.setAttributes({disabled:"true"}),this.garageButton.removeAttribute("disabled"))}}class g extends i{constructor(t){super({tag:"input"}),this.setType(t.type)}get value(){return this._element.value}set value(t){this._element.value=t}disable(){this._element.setAttribute("disabled","true")}enable(){this._element.removeAttribute("disabled")}setType(t){this._element.setAttribute("type",t)}}class _ extends i{options;textInput;colorInput;constructor(t){super({tag:"form"}),this.options=t,this.textInput=new g({type:"text"}),this.colorInput=new g({type:"color"}),this.render()}disable(){this.children.forEach(t=>{(t instanceof c||t instanceof g)&&t.disable()})}enable(){this.children.forEach(t=>{(t instanceof c||t instanceof g)&&t.enable()})}render(){const t=new c({text:this.options.buttonText,callback:e=>{e.preventDefault(),this.options.callback(this.textInput.value,this.colorInput.value).catch(s=>{console.error("Error in callback:",s)})}});this.appendChildren(this.textInput,this.colorInput,t)}}class v extends p{_element;constructor(t){super(),this._element=document.createElementNS("http://www.w3.org/2000/svg","svg"),t.classNames&&this.addClasses(t.classNames),this.setAttributes(t.attributes);const e=document.createElementNS("http://www.w3.org/2000/svg","use");e.setAttribute("href",t.href),this.appendChildren(e)}}const W="_card_1mqry_1",k="_select_1mqry_10",F="_title_1mqry_18",N="_start_1mqry_23",M="_reset_1mqry_27",U="_car_1mqry_1",O="_flag_1mqry_36",u={card:W,select:k,delete:"_delete_1mqry_14",title:F,start:N,reset:M,car:U,flag:O};class b extends i{car;id;buttons;startButton;backButton;name;color;carImage;constructor(t,e,s){super({tag:"div",classNames:[u.card]}),this.id=t,this.name=e,this.color=s,this.car=new i({tag:"div",classNames:[u.car]}),this.carImage=new v({href:"./sprite.svg#auto",attributes:{width:"100",height:"50"}}),this.buttons=[],this.startButton=new c({classNames:[u.start],text:"Start",callback:()=>{const r=new CustomEvent("carMoveStarted",{detail:{id:this.id},bubbles:!0});this.backButton.enable(),this.startButton.disable(),this.node.dispatchEvent(r)}}),this.backButton=new c({classNames:[u.reset],text:"B",callback:()=>{const r=new CustomEvent("carMoveReset",{detail:{id:this.id},bubbles:!0});this.startButton.enable(),this.backButton.disable(),this.node.dispatchEvent(r)}}),this.backButton.disable(),this.render()}changeCarColor(t){this.carImage.node.setAttribute("fill",t)}render(){const t=new i({tag:"h3",text:this.name,classNames:[u.title]});this.changeCarColor(this.color);const e=new c({text:"Select",classNames:[u.select],callback:()=>{const n=new CustomEvent("carSelected",{detail:{id:this.id,name:this.name,color:this.color},bubbles:!0});this.node.dispatchEvent(n)}});this.car.appendChildren(this.carImage);const s=new c({text:"Remove",classNames:[u.delete],callback:()=>{const n=new CustomEvent("carRemoved",{detail:{id:this.id},bubbles:!0});this.node.dispatchEvent(n)}}),r=new v({classNames:[u.flag],href:"./sprite.svg#flag",attributes:{width:"40",height:"40"}});this.buttons.push(e,s,this.startButton,this.backButton),this.appendChildren(e,s,t,this.startButton,this.backButton,this.car,r)}}class f{static BASE_URL="http://localhost:3000/engine";static async startEngine(t){const e=await fetch(`${this.BASE_URL}?id=${t}&status=started`,{method:"PATCH"});if(!e.ok)throw new Error("Failed to start engine");return e.json()}static async stopEngine(t){if(!(await fetch(`${this.BASE_URL}?id=${t}&status=stopped`,{method:"PATCH"})).ok)throw new Error("Failed to stop engine")}static async drive(t){const e=await fetch(`${this.BASE_URL}?id=${t}&status=drive`,{method:"PATCH"});if(!e.ok)throw e.status===500?new Error("Engine failure"):new Error("Failed to drive");return e.json()}}class m{static animationFrameIds=new Map;static isAnimating=new Map;static isEngineRunning=new Map;static stopAnimation(t){this.isAnimating.set(t,!1),this.animationFrameIds.has(t)&&(cancelAnimationFrame(this.animationFrameIds.get(t)),this.animationFrameIds.delete(t))}static resetCarPosition(t,e){this.isAnimating.set(t,!1),this.isEngineRunning.set(t,!1),e.style.transform="translateX(0px)"}static async moveCar(t,e){const s=await f.startEngine(t.id);if(typeof s!="object"||s===null||!("distance"in s)||!("velocity"in s)||typeof s.distance!="number"||typeof s.velocity!="number")throw new Error("Invalid response from engine service");const r=e/s.velocity;return this.isAnimating.set(t.id,!0),this.isEngineRunning.set(t.id,!0),await Promise.all([this.animateCar(t.id,t.element,r,e),this.monitorDriveStatus(t.id)]),r}static async startRace(t){const e=t.map(({id:r,element:n})=>{const o=n.parentElement.clientWidth-n.offsetWidth;return this.moveCar({id:r,element:n},o).then(h=>({id:r,time:h})).catch(()=>null)});return await Promise.race(e)}static resetAll(t){t.forEach(({id:e,element:s})=>{this.resetCarPosition(e,s)})}static async monitorDriveStatus(t){try{try{await f.drive(t)}catch(e){for(;this.isAnimating.get(t);){if(e instanceof Error&&e.message==="Engine failure"){this.stopAnimation(t),await f.stopEngine(t);break}if(e instanceof Error&&e.message.includes("Failed to drive"))break}await new Promise(s=>setTimeout(s,500))}}catch(e){console.error(` Unexpected error for car ${t}:`,e)}}static async animateCar(t,e,s,r){const n=performance.now();return new Promise(o=>{const h=A=>{if(!this.isAnimating.get(t))return;const L=(A-n)/1e3,y=Math.min(L/s,1);if(e.style.transform=`translateX(${y*r}px)`,y<1){const S=requestAnimationFrame(h);this.animationFrameIds.set(t,S)}else this.isAnimating.set(t,!1),this.isEngineRunning.set(t,!1),o()},d=requestAnimationFrame(h);this.animationFrameIds.set(t,d)})}}function I(a){return typeof a=="object"&&a!==null&&"id"in a&&typeof a.id=="number"&&"name"in a&&typeof a.name=="string"&&"color"in a&&typeof a.color=="string"}function C(a){return typeof a=="object"&&a!==null&&"id"in a&&typeof a.id=="number"}const H="_modal_1atks_1",j={modal:H};class K extends i{constructor(t,e){super({tag:"div"}),this.addClasses([j.modal]),this.setText(`${t} is the winner! Time: ${e.toFixed(2)}s`),globalThis.addEventListener("click",s=>{s.target!==this.node&&this.deleteElement()})}}class l{static BASE_URL="http://localhost:3000";static getCar(t){return fetch(`${this.BASE_URL}/garage/${t}`).then(e=>e.ok?e.json():null)}static async getCars(t,e=7){const s=await fetch(`${this.BASE_URL}/garage?_page=${t}&_limit=${e}`);if(!s.ok)throw new Error("Failed to fetch cars");const r=await s.json(),n=Number(s.headers.get("X-Total-Count"))||0;return{cars:r,total:n}}static async createCar(t,e){await fetch(`${this.BASE_URL}/garage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,color:e})})}static async deleteCar(t){await fetch(`${this.BASE_URL}/garage/${t}`,{method:"DELETE"})}static async updateCar(t){await fetch(`${this.BASE_URL}/garage/${t.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t.name,color:t.color})})}static async getWinners(t,e=10,s,r){const n=new URLSearchParams({_page:String(t),_limit:String(e)});s&&n.set("_sort",s),r&&n.set("_order",r);const o=await fetch(`${this.BASE_URL}/winners?${n.toString()}`);if(!o.ok)throw new Error("Failed to fetch winners");const h=await o.json(),d=Math.max(Number(o.headers.get("X-Total-Count"))||0,h.length);return{items:h,total:d}}static async getWinner(t){const e=await fetch(`${this.BASE_URL}/winners/${t}`);return e.ok?e.json():null}static async createWinner(t){await fetch(`${this.BASE_URL}/winners`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}static async updateWinner(t,e){await fetch(`${this.BASE_URL}/winners/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}static async deleteWinner(t){await fetch(`${this.BASE_URL}/winners/${t}`,{method:"DELETE"})}static async getAllWinners(t,e){const s=new URLSearchParams;t&&s.set("_sort",t),e&&s.set("_order",e);const r=await fetch(`${this.BASE_URL}/winners?${s.toString()}`);if(!r.ok)throw new Error("Failed to fetch all winners");return await r.json()}}class q extends i{raceButton;resetButton;generateButton;constructor(t){super({tag:"div"}),this.raceButton=new c({text:"Race",callback:t.onRace}),this.resetButton=new c({text:"Reset",callback:t.onReset}),this.resetButton.disable(),this.generateButton=new c({text:"Generate cars",callback:t.onGenerate}),this.appendChildren(this.raceButton,this.resetButton,this.generateButton)}disable(){this.raceButton.disable(),this.generateButton.disable(),this.resetButton.disable()}enable(){this.raceButton.enable(),this.generateButton.enable(),this.resetButton.enable()}setResetEnabled(t){t?this.resetButton.enable():this.resetButton.disable()}}class D extends i{selectedCarId=null;outlet;title;pageNumber;store;carListContainer;createForm;updateForm;controls;activeCars=new Set;pagination;constructor(t,e){super({tag:"div"}),this.store=t,this.outlet=e,this.title=new i({tag:"h1",text:"Garage (0)"}),this.pageNumber=new i({tag:"h2",text:"Page #1"}),this.carListContainer=new i({tag:"div"}),this.store.total$.subscribe(s=>{this.title.setText(`Garage (${s})`)}),this.controls=new q({onRace:()=>{this.startRace()},onReset:()=>this.resetAll(),onGenerate:()=>{this.store.generateRandomCars()}}),this.createForm=this.renderCreateForm(),this.updateForm=this.renderUpdateForm(),this.pagination=this.renderPagination(),this.render(),this.bindStore()}handleSelectCar(t){this.selectedCarId=t,this.controls.disable()}render(){this.updateForm.disable(),this.appendChildren(this.createForm,this.updateForm,this.controls,this.title,this.pageNumber,this.carListContainer,this.pagination)}renderCreateForm(){return new _({buttonText:"Create",callback:async(t,e)=>{try{await this.store.addCar(t,e)}catch(s){console.error("Error while adding car:",s)}}})}renderUpdateForm(){return new _({buttonText:"Update",callback:async(t,e)=>{if(this.selectedCarId===null){console.error("No car selected!");return}try{await this.store.updateCar({id:this.selectedCarId,name:t,color:e}),this.updateForm.disable(),this.createForm.enable(),this.selectedCarId=null,this.controls.enable()}catch(s){console.error("Error while updating car:",s)}}})}async startRace(){this.pagination.children.forEach(e=>{e instanceof c&&e.disable()}),this.updateForm.disable(),this.createForm.disable(),this.controls.disable(),this.controls.setResetEnabled(!0);const t=[];for(const e of this.carListContainer.children)e instanceof b&&e.car.node instanceof HTMLElement&&(e.buttons.forEach(s=>s.disable()),t.push({id:e.id,element:e.car.node}));try{const e=await m.startRace(t);if(e){const s=await l.getCar(e.id);s&&(await this.store.addWinner(e.id,e.time),this.outlet.appendChildren(new K(s.name,e.time)))}}catch(e){console.error("Race error:",e)}}resetAll(){this.controls.enable(),this.pagination.children.forEach(e=>{e instanceof c&&e.enable()}),this.controls.setResetEnabled(!0);const t=[];for(const e of this.carListContainer.children)e instanceof b&&e.car.node instanceof HTMLElement&&(e.buttons.forEach(s=>{s!==e.backButton&&s.enable()}),t.push({id:e.id,element:e.car.node}));m.resetAll(t),this.activeCars.clear(),this.controls.setResetEnabled(!1)}renderPagination(){const t=new i({tag:"div"}),e=new c({text:"Prev",callback:()=>{this.store.previous("garage").catch(r=>{console.error("Error going to the previous page:",r)})}}),s=new c({text:"Next",callback:()=>{this.store.next("garage").catch(r=>{console.error("Error going to the next page:",r)})}});return this.store.cars$.subscribe(()=>{const r=this.store.getCurrentPage("garage"),n=this.store.total$.value,o=Math.ceil(n/this.store.pageLimits.garage);r===1?e.disable():e.enable(),r===o?s.disable():s.enable()}),t.appendChildren(e,s),t}bindStore(){this.store.cars$.subscribe(t=>this.renderCarList(t)),this.store.total$.subscribe(t=>{this.pageNumber.setText(`Page #${this.store.getCurrentPage("garage")} / Total cars: ${t}`)}),this.store.loadCars(this.store.getCurrentPage("garage")).catch(t=>{console.error("Error loading cars:",t)})}renderCarList(t){this.carListContainer.deleteChildren(),t.forEach(e=>{const s=new b(e.id,e.name,e.color);s.addListener("carSelected",r=>{r instanceof CustomEvent&&I(r.detail)&&(this.createForm.disable(),this.updateForm.enable(),this.handleSelectCar(r.detail.id))}),s.addListener("carRemoved",r=>{(async()=>{if(r instanceof CustomEvent&&C(r.detail)){const n=r.detail.id;try{await this.store.removeCar(n)}catch(o){console.error("Error while removing car:",o)}}})()}),s.addListener("carMoveStarted",r=>{(async()=>{if(r instanceof CustomEvent&&C(r.detail)){const n=r.detail.id;this.activeCars.add(n),this.controls.setResetEnabled(!0);try{const o=s.car.node;o instanceof HTMLElement?await m.moveCar({id:n,element:o},this.outlet.node.clientWidth-o.offsetWidth):console.error("Car element is not a valid HTMLElement.")}catch(o){console.error("Error while starting car:",o)}}})()}),s.addListener("carMoveReset",r=>{(()=>{if(r instanceof CustomEvent&&C(r.detail)){const n=r.detail.id;s.car.node instanceof HTMLElement&&m.resetCarPosition(n,s.car.node),this.activeCars.delete(n),this.activeCars.size===0&&this.controls.setResetEnabled(!1)}})()}),this.carListContainer.appendChildren(s)})}}class G extends i{constructor(t){super({tag:"div"}),this.store=t,this.render(),this.store.winnersCount$.subscribe(()=>{this.updateButtons(),this.updatePageNumber()}),this.ensureValidPage(),this.loadCurrentWinners(),this.store.winners$.subscribe(e=>{this.renderWinners(e),this.ensureValidPage()})}title=new i({tag:"h1",text:"Winners (0)"});pageNumber=new i({tag:"h2",text:"Page #1"});tableBody=new i({tag:"tbody"});headerWins=new i({tag:"th"});headerBestTime=new i({tag:"th"});sortAllWinners=!0;sortKey="time";sortOrder="asc";previousButton=new c({text:"Prev",callback:()=>void this.store.previous("winners")});nextButton=new c({text:"Next",callback:()=>void this.store.next("winners")});async ensureValidPage(){const t=this.store.pageLimits.winners,e=this.store.winnersCount$.value,s=Math.max(1,Math.ceil(e/t));this.store.getCurrentPage("winners")>s&&await this.store.loadWinners(s,this.store.pageLimits.winners,this.sortKey,this.sortOrder.toUpperCase(),this.sortKey==="wins"&&this.sortAllWinners)}async loadCurrentWinners(){const t=this.store.getCurrentPage("winners"),e=this.store.pageLimits.winners;await this.store.loadWinners(t,e,this.sortKey,this.sortOrder.toUpperCase(),this.sortKey==="wins"&&this.sortAllWinners)}updateButtons(){const t=this.store.getCurrentPage("winners"),e=this.store.pageLimits.winners,s=this.store.winnersCount$.value,r=Math.ceil(s/e);this.previousButton.setDisabled(t===1),this.nextButton.setDisabled(t>=r)}updatePageNumber(){const t=this.store.getCurrentPage("winners");this.pageNumber.setText(`Page #${t}`)}render(){const t=new i({tag:"table"}),e=new i({tag:"thead"}),s=new i({tag:"tr"}),r=new i({tag:"th",text:"№"}),n=new i({tag:"th",text:"ID"}),o=new i({tag:"th",text:"Car"}),h=new i({tag:"th",text:"Name"});this.headerWins.node.style.cursor="pointer",this.headerWins.addListener("click",()=>void this.toggleSort("wins")),this.headerBestTime.node.style.cursor="pointer",this.headerBestTime.addListener("click",()=>void this.toggleSort("time")),s.appendChildren(r,n,o,h,this.headerWins,this.headerBestTime),e.appendChildren(s),t.appendChildren(e,this.tableBody),this.appendChildren(this.title,this.pageNumber,t),this.updateHeaders(),this.renderControls()}async toggleSort(t){this.sortKey===t?this.sortOrder=this.sortOrder==="desc"?"asc":"desc":(this.sortKey=t,this.sortOrder="desc"),this.store.winnersSortKey=this.sortKey,this.store.winnersSortOrder=this.sortOrder.toUpperCase(),this.store.sortAllWinners=this.sortKey==="wins"&&this.sortAllWinners,this.updateHeaders(),await this.loadCurrentWinners()}async renderWinners(t){this.tableBody.deleteChildren(),this.title.setText(`Winners (${this.store.winnersCount$.value})`);let e=(this.store.getCurrentPage("winners")-1)*this.store.pageLimits.winners+1;for(const s of t){const r=new i({tag:"tr"});r.appendChildren(new i({tag:"td",text:(e++).toString()}),new i({tag:"td",text:`${s.id}`}));try{const n=await l.getCar(s.id);r.appendChildren(new v({href:"./sprite.svg#auto",attributes:{width:"40",height:"40",fill:n?.color||"#000000"}}),new i({tag:"td",text:n?.name||"Unknown"}),new i({tag:"td",text:`${s.wins}`}),new i({tag:"td",text:`${s.time.toFixed(2)}`}))}catch(n){console.error(`Error loading car ${s.id}`,n)}this.tableBody.appendChildren(r)}}getHeaderText(t,e){return this.sortKey===t?`${e} ${this.sortOrder==="asc"?"↑":"↓"}`:e}updateHeaders(){this.headerWins.setText(this.getHeaderText("wins","Wins")),this.headerBestTime.setText(this.getHeaderText("time","Best Time (seconds)"))}renderControls(){this.appendChildren(this.previousButton,this.nextButton),this.updateButtons()}}class X{listeners=new Set;emit(t){for(const e of this.listeners)e(t)}subscribe(t){return this.listeners.add(t),this.unsubscribe.bind(this,t)}unsubscribe(t){this.listeners.delete(t)}}class w extends X{constructor(t){super(),this._value=t}get value(){return this._value}set(t){this._value=t,this.emit(this._value)}update(t){this._value=t(this._value),this.emit(this._value)}silentUpdate(t){this._value=t(this._value)}}const V=16777215,J=()=>`#${Math.floor(Math.random()*V).toString(16)}`,x=a=>a[Math.floor(Math.random()*a.length)];class z{cars$=new w([]);total$=new w(0);winners$=new w([]);winnersCount$=new w(0);winnersSortKey="time";winnersSortOrder="ASC";sortAllWinners=!1;pageLimits={garage:7,winners:10};currentPage={garage:1,winners:1};pageLoaders={garage:this.loadCars.bind(this),winners:this.loadWinners.bind(this)};async next(t){const e=this.currentPage[t]+1;this.currentPage[t]=e,await this.pageLoaders[t](e,this.pageLimits[t])}async previous(t){const e=Math.max(1,this.currentPage[t]-1);this.currentPage[t]=e,await this.pageLoaders[t](e,this.pageLimits[t])}getCurrentPage(t){return this.currentPage[t]}async addCar(t,e){try{await l.createCar(t,e),await this.loadCars(this.currentPage.garage)}catch(s){this.handleError(s,"Failed to add car")}}async removeCar(t){try{await l.deleteCar(t),await l.deleteWinner(t),await this.loadCars(this.currentPage.garage),await this.reloadCurrentWinnersPage()}catch(e){this.handleError(e,"Error deleting car")}}async updateCar(t){try{await l.updateCar(t),await this.loadCars(this.currentPage.garage);const e=await l.getWinner(t.id);e&&(await l.updateWinner(t.id,{wins:e.wins,time:e.time}),await this.loadWinners(this.currentPage.winners,this.pageLimits.winners),await this.reloadCurrentWinnersPage())}catch(e){this.handleError(e,"Error updating car")}}async loadWinners(t,e,s=this.winnersSortKey,r=this.winnersSortOrder,n=this.sortAllWinners){this.winnersSortKey=s,this.winnersSortOrder=r,this.sortAllWinners=n;try{let o=[],h;if(n){const d=await l.getAllWinners(s,r);h=d.length,o=d.slice((t-1)*e,t*e)}else{const d=await l.getWinners(t,e,s,r);o=d.items,h=d.total}this.winners$.set([...o]),this.winnersCount$.set(h),this.currentPage.winners=t}catch(o){this.handleError(o,"Error loading winners")}}async loadCars(t){try{const{cars:e,total:s}=await l.getCars(t);this.cars$.set(e),this.total$.set(s),this.currentPage.garage=t}catch(e){this.handleError(e,"Error loading cars")}}async addWinner(t,e){await this.reloadCurrentWinnersPage();try{const s=await l.getWinner(t);await(s?l.updateWinner(t,{time:Math.min(s.time,e),wins:s.wins+1}):l.createWinner({id:t,wins:1,time:e})),await this.loadWinners(this.currentPage.winners,this.pageLimits.winners)}catch(s){this.handleError(s,"Error adding/updating winner")}}async reloadCurrentWinnersPage(){const t=this.getCurrentPage("winners"),e=this.pageLimits.winners;await this.loadWinners(t,e,this.winnersSortKey,this.winnersSortOrder,this.sortAllWinners)}getWinners(){return[...this.winners$.value]}async generateRandomCars(){const t=["Ford","BMW","Audi","Mercedes","Tesla","Toyota","Honda","Nissan","Lexus","Porsche"],e=["X1","X3","X5","A4","A6","C-Class","E-Class","Model S","Model 3","Camry","Civic","Altima","RX","911","Macan"],s=Array.from({length:100},()=>{const r=`${x(t)} ${x(e)}`,n=J();return l.createCar(r,n)});try{await Promise.all(s),await this.loadCars(this.currentPage.garage)}catch(r){r instanceof Error?console.error("Error generating cars:",r.message):console.error("Unknown error:",r)}}handleError(t,e){t instanceof Error?console.error(`${e}:`,t.message):console.error(`${e}: Unknown error`,t)}}class Q{defaultRoute="/garage";routes;outlet;constructor(t,e){this.routes=t,this.outlet=e,globalThis.addEventListener("hashchange",()=>{this.loadRoute()}),globalThis.location.hash===""?this.navigate(this.defaultRoute):this.loadRoute()}async loadRoute(){const t=globalThis.location.hash.slice(1),e=this.routes.find(s=>s.path===t);if(e){const s=await e.page(this);this.outlet.node.replaceChildren(s.node)}else console.error(`Route for path ${t} not found.`)}navigate(t){globalThis.location.hash=t}}const Y=[{path:"/garage",page:()=>Promise.resolve(tt)},{path:"/winners",page:()=>Promise.resolve(et)}];class Z extends i{constructor(){super({tag:"div"});const t=new i({tag:"h1",text:"404"}),e=new i({tag:"p",text:"Page not found"});this.appendChildren(t,e)}}const B=new i({tag:"div"}),E=new i({tag:"div"});document.body.append(B.node);const P=new z,tt=new D(P,E),et=new G(P);new Z;const st=new T;B.appendChildren(st,E);new Q(Y,E);
