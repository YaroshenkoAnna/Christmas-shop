import{O as S,S as f,B as u,M as b,D as M,o as v}from"./index-BX1IQno_.js";import{I as _,T as y}from"./input-BcyWsxIj.js";import{B as p}from"./button-DSwA1G1O.js";const I="_container_10tfi_7",T="_back_10tfi_44",k="_sound_10tfi_48",C="_start_10tfi_52",A="_disabled_10tfi_56",P="_picked_10tfi_61",a={"wheel-page":"_wheel-page_10tfi_1",container:I,"result-container":"_result-container_10tfi_8","wheel-result":"_wheel-result_10tfi_36",back:T,sound:k,start:C,disabled:A,picked:P},w="soundDisabled";class E{soundDisabled=new S(f.load(w)??!0);sounds=[];constructor(){this.soundDisabled.subscribe(t=>{f.save(w,t),this.handleSoundState(t)}),this.handleSoundState(this.soundDisabled.value)}toggleSound(){this.soundDisabled.set(!this.soundDisabled.value)}registerSound(t){this.sounds.push(t),t.muted=this.soundDisabled.value}handleSoundState(t){this.sounds.forEach(e=>{e.muted=t,e.volume=t?0:1})}}const x=new E;function N(h,t){const e=Math.ceil(h),n=Math.floor(t);return Math.floor(Math.random()*(n-e+1))+e}function B(){const h=[];for(let s=0;s<3;s++)h.push(N(100,255));const[t,e,n]=h;return`rgb(${t}, ${e}, ${n})`}function D(h){const t=[...h];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}const O="_wheel_1q71f_1",W={wheel:O};class F extends u{context;options;rotationAngle=0;isSpinning=!1;segmentColors;onSegmentChange;lastSegmentIndex=null;animationId=null;constructor(t,e){super({tag:"canvas",classNames:[W.wheel]}),this.node.width=500,this.node.height=500;const n=this.node.getContext("2d");if(!n)throw new Error("Failed to get 2D context");this.onSegmentChange=e,this.options=D(t.filter(s=>s.weight!==void 0&&s.weight>0&&s.title)),this.context=n,this.segmentColors=this.options.map(()=>B()),this.clearCanvas(),this.render(),this.lastSegmentIndex=null}spinWheel(t){if(this.isSpinning)return;this.isSpinning=!0;const e=this.rotationAngle,n=performance.now(),s=e+Math.PI*2*t+Math.PI*2*Math.random(),i=r=>r===0?0:r===1?1:r<.5?Math.pow(2,20*r-10)/2:(2-Math.pow(2,-20*r+10))/2,o=r=>{const g=(r-n)/1e3,l=Math.min(g/t,1);this.rotationAngle=e+(s-e)*i(l),this.render(),l<1?this.animationId=requestAnimationFrame(o):this.isSpinning=!1};this.animationId=requestAnimationFrame(o)}deleteElement(){super.deleteElement(),this.animationId&&cancelAnimationFrame(this.animationId)}render(){this.context.save(),this.clearCanvas(),this.context.translate(250,250),this.context.rotate(this.rotationAngle),this.context.translate(-250,-250),this.drawMainCircle(),this.drawSegments(),this.drawCenter(),this.context.restore(),this.drawArrow();const t=this.getSegmentIndexByArrow();if(t!==null&&t!==this.lastSegmentIndex){const e=this.options[t].title;this.onSegmentChange&&this.onSegmentChange(e),this.lastSegmentIndex=t}}drawMainCircle(){this.context.beginPath(),this.context.arc(250,250,201,0,2*Math.PI),this.context.lineWidth=29,this.context.strokeStyle="rgb(186, 186, 186)",this.context.stroke(),this.context.arc(250,250,216,0,2*Math.PI),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke(),this.context.stroke(),this.context.arc(250,250,220,0,2*Math.PI),this.context.lineWidth=5,this.context.strokeStyle="rgba(0, 0, 0, 0.2)",this.context.stroke()}drawSegments(){const t=this.options.length,e=this.options.reduce((s,i)=>s+(i.weight??0),0);let n=0;for(let s=0;s<t;s++){const i=n,o=i+2*Math.PI/e*(this.options[s].weight??0);n=o,this.context.beginPath(),this.context.moveTo(250,250),this.context.arc(250,250,200,i,o),this.context.lineTo(250,250),this.context.fillStyle=this.segmentColors[s],this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke(),this.drawSegmentText(this.options[s].title,i,o)}}drawCenter(){this.context.beginPath(),this.context.arc(250,250,25,0,2*Math.PI),this.context.fillStyle="rgba(0, 92, 138)",this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke(),this.context.arc(250,250,23,0,2*Math.PI),this.context.lineWidth=3,this.context.strokeStyle="rgb(241, 212, 212)",this.context.stroke(),this.context.arc(250,250,26,0,2*Math.PI),this.context.lineWidth=4,this.context.strokeStyle="rgba(0, 0, 0, 0.5)",this.context.stroke()}drawSegmentText(t,e,n){const i=(e+n)/2,o=250+110*Math.cos(i),r=250+110*Math.sin(i),g=(n-e)*200/Math.PI;this.context.font="16px Arial",this.context.fillStyle="rgb(0, 0, 0)",this.context.textAlign="center",this.context.textBaseline="middle";const l=this.context.measureText(t);if(l.actualBoundingBoxAscent+l.actualBoundingBoxDescent>g)return;const m=140;let d=t;for(;this.context.measureText(d).width>m;)d=d.slice(0,-1);d.length<t.length&&(d+="..."),this.context.save(),this.context.translate(o,r),this.context.rotate(i),this.context.fillText(d,0,0),this.context.restore()}clearCanvas(){this.context.clearRect(0,0,this.node.width,this.node.height)}drawArrow(){this.context.save(),this.context.shadowColor="rgba(0, 0, 0, 0.5)",this.context.shadowOffsetX=2,this.context.shadowOffsetY=2,this.context.beginPath(),this.context.moveTo(250,70),this.context.lineTo(240,30),this.context.lineTo(260,30),this.context.lineTo(250,70),this.context.fillStyle="rgb(186, 186, 186)",this.context.strokeStyle="rgb(0, 0, 0)",this.context.fill(),this.context.stroke(),this.context.restore()}getSegmentIndexByArrow(){let t=Math.PI/2-this.rotationAngle+Math.PI;t=(t+2*Math.PI*100)%(2*Math.PI),t<0&&(t+=2*Math.PI);let e=0;const n=this.options.reduce((s,i)=>s+(i.weight??0),0);for(let s=0;s<this.options.length;s++){const i=e,o=i+2*Math.PI/n*(this.options[s].weight??0);if(t>=i&&t<=o)return s;e=o}return null}}function V(h,t,e){return h<e?(t.setCustomValidity(`Duration must be at least ${e} seconds`),t.reportValidity(),!1):(t.setCustomValidity(""),!0)}class H extends u{victorySound=new Audio("victory.mp3");interactiveElements=[];spinTimeout;constructor(){super({tag:"main",classNames:[a["wheel-page"]]}),x.registerSound(this.victorySound);const t=new p({text:"Back to Options",callback:()=>{globalThis.location.hash="/"},classNames:[a.back]}),e=new p({text:x.soundDisabled.value?"Sound: Off":"Sound: On",callback:()=>{x.toggleSound()},classNames:[a.sound]});x.soundDisabled.subscribe(c=>{e.setText(c?"Sound: Off":"Sound: On")});const n=new _({type:"number",name:"time",attributes:{min:b.toString()},id:"Time",classNames:[a.time]});n.setValue(M.toString());const s=new u({tag:"div",classNames:[a["result-container"]]}),i=new u({tag:"p",classNames:[a["wheel-result"]]});s.appendChildren(i);const o=new F(v.value,c=>{i.setText(`${c}`)});i.setText("press start to spin the wheel");const r=new p({text:"Start",callback:()=>{const c=Number(n.getValue());V(c,n.node,b)&&(this.disable(),s.removeClasses([a.picked]),o.spinWheel(Number(n.getValue())),this.spinTimeout=setTimeout(()=>{this.enable(),s.addClasses([a.picked]),this.victorySound.play().catch(m=>{console.error("Failed to play victory sound:",m)})},c*1e3))},classNames:[a.start]}),g=new u({tag:"span",text:"Time",classNames:[a.span]}),l=new u({tag:"div",classNames:[a.container]});l.appendChildren(g,n),this.appendChildren(new y,t,e,l,r,s,o),this.interactiveElements=[n,r,t,e,l]}deleteElement(){super.deleteElement(),clearTimeout(this.spinTimeout),this.victorySound.pause(),this.victorySound.currentTime=0}disable(){this.interactiveElements.forEach(t=>{t.setAttributes({disabled:"true"}),t.addClasses([a.disabled])})}enable(){this.interactiveElements.forEach(t=>{t.removeAttribute("disabled"),t.removeClasses([a.disabled])})}}export{H as WheelPage};
