import{B as c,b as h}from"./button-BqEWFG3Z.js";import{O as E,S as g,B as d}from"./index-iq7NPcE8.js";import{D as f,I as _,t as L}from"./numbers-B-p1t3BL.js";const y="_options_1aopn_1",C={options:y},S="_option_977kk_1",x={option:S},N="options";class I extends E{idCounter=f;constructor(){super(g.load("options")??[]);const t=this.value.reduce((n,e)=>Math.max(n,e.id),f);this.idCounter=t+1,this.subscribe(n=>g.save(N,n))}addOption(t){const n={id:this.idCounter++,...t};this.update(e=>[...e,n])}updateOption(t,n){this.silentUpdate(e=>e.map(o=>o.id===t?{...o,...n}:o)),g.save(N,this.value)}removeOption(t){this.update(n=>n.filter(e=>e.id!==t)),this.value.length===0&&(this.idCounter=f)}reset(){this.idCounter=f,this.set([])}}const r=new I;class O extends d{timeoutId=null;lastValue="";constructor(t){super({tag:"li",classNames:[x.option]}),this.render(t)}render(t){const n=new d({tag:"span",classNames:[x.id],text:t.id.toString()}),e=new _({type:"text",name:"title",attributes:{placeholder:"Title"},id:t.id.toString()});e.setValue(t.title);const o=a=>m=>{m!==this.lastValue&&(this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{r.updateOption(t.id,{[a]:m}),this.lastValue=m},200))};e.addListener("input",()=>{const a=e.getValue();t.title!==a&&o("title")(a)});const i=new _({type:"number",name:"weight",attributes:{placeholder:"Weight",min:"0"}});i.setValue(t.weight.toString()),i.addListener("input",()=>{const a=Number(i.getValue());t.weight!==a&&o("weight")(a)});const u=new c({text:"Delete",callback:()=>{this.deleteElement(),r.removeOption(t.id)}});this.appendChildren(n,e,i,u)}}const k="_modal_j9i83_1",j="_container_j9i83_8",B="_form_j9i83_18",A="_warning_j9i83_24",T="_button_j9i83_39",V="_textarea_j9i83_53",p={modal:k,container:j,form:B,warning:A,button:T,"modal-button":"_modal-button_j9i83_44","buttons-container":"_buttons-container_j9i83_48",textarea:V};class v extends d{constructor(){super({tag:"dialog",classNames:[p.modal]})}open(){document.body.append(this.node),this.node.showModal()}close(){this.node.close(),this.deleteElement()}render(){const t=new d({tag:"div",classNames:[p.container]});return this.appendChildren(t),t}}const R=`Paste a list of new options in a CSV-like format:

title,1                 -> | title                 | 1 |
title with whitespace,2 -> | title with whitespace | 2 |
title , with , commas,3 -> | title , with , commas | 3 |
title with &quot;quotes&quot;,4   -> | title with &quot;quotes&quot;   | 4 |`,M=`Please add at least 2 valid options.

An option is considered valid if its title is not empty and its weight is greater than 0.`;class P extends v{constructor(){super(),this.renderContent()}renderContent(){const t=new d({tag:"p",text:M,classNames:[p.warning]}),n=new c({classNames:[p.button],text:"Close",callback:()=>{this.close()}});this.render().appendChildren(t,n)}}function q(s){return s.split(`
`)}function U(s){return s.map(e=>{const o=e.lastIndexOf(",");return o===-1?[e]:[e.slice(0,o),e.slice(o+1)]}).filter(e=>F(e)).map(([e,o])=>[e.trim(),Number(o.trim())]).filter(([e,o])=>typeof o=="number"&&!Number.isNaN(o)&&o>0?e&&o%1===0:!1)}function F(s){return s.length===2}function W(s=[]){for(const[t,n]of s)r.addOption({title:t,weight:n});console.log(s)}class J extends v{constructor(){super(),this.renderContent()}renderContent(){const t=new d({tag:"form",classNames:[p.form]});this.render().appendChildren(t);const e=new d({tag:"textarea",classNames:[p.textarea],attributes:{rows:"12",cols:"64",name:"table",placeholder:R}}),o=new d({tag:"div",classNames:[p["buttons-container"]]}),i=new c({text:"Cancel",callback:a=>{a.preventDefault(),this.close()},classNames:[p["modal-button"]]}),u=new c({text:"Confirm",callback:a=>{this.onConfirm(a,e.node.value)},classNames:[p["modal-button"]]});o.appendChildren(i,u),t.appendChildren(e,o)}onConfirm(t,n){t.preventDefault(),this.close();const e=q(n);if(e.length===0)return;const o=U(e);console.log(o),o.length!==0&&W(o)}}function G(s){return s.filter(n=>n.title!==""&&n.weight!==0).length>1}function $(s,t){const n=JSON.stringify(s,null,2),e=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(e),i=document.createElement("a");i.href=o,i.download=t,document.body.append(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)}function D(s){const t=document.createElement("input");t.type="file",t.accept="application/json",t.addEventListener("change",n=>{const e=n.target;if(!e.files||e.files.length===0)return;e.files[0].text().then(i=>{try{const u=JSON.parse(i);s(u)}catch(u){console.error("Error loading JSON:",u)}}).catch(i=>{console.error("Error reading file:",i)})}),t.click()}class z extends d{constructor(){super({tag:"main",classNames:[C.optionsPage]});const t=new d({tag:"ul",classNames:[C.options]});this.sub(r.subscribe(l=>{t.deleteChildren(),l.forEach(b=>{const w=new O(b);t.appendChildren(w)})}));const n=r.value;n.length>0&&n.forEach(l=>{const b=new O(l);t.appendChildren(b)});const e=new c({text:"Add Option",callback:()=>{r.addOption({title:"",weight:0})},classNames:[h["control-button"]]});this.sub(r.subscribe(l=>{t.deleteChildren(),l.forEach(b=>{const w=new O(b);t.appendChildren(w)})}));const o=new c({text:"Paste List",callback:()=>{new J().open()},classNames:[h["control-button"]]}),i=new c({text:"Clear List",callback:()=>{t.deleteChildren(),r.reset()},classNames:[h["control-button"]]}),u=new c({text:"Save List to File",callback:()=>{const l=r.value;$(l,"options.json")},classNames:[h["control-button"]]}),a=new c({text:"Load List from File",callback:()=>{D(l=>{r.set(l)})},classNames:[h["control-button"]]}),m=new c({text:"Start",callback:()=>{G(n)?(globalThis.location.hash="/wheel",this.unsubscribeAll()):new P().open()},classNames:[h["control-button"]]});this.appendChildren(L,t,e,o,i,u,a,m)}}export{z as OptionsPage};
