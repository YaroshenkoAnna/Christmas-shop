import{B as c,b as h}from"./button-CFO-CYps.js";import{B as d}from"./index-C0n3vUYj.js";import{D as f,I as x,t as E}from"./numbers-CaCpblks.js";const y="_options_1aopn_1",O={options:y},L="_option_977kk_1",C={option:L};class k{listeners=new Set;emit(t){for(const n of this.listeners)n(t)}subscribe(t){return this.listeners.add(t),this.unsubscribe.bind(this,t)}unsubscribe(t){this.listeners.delete(t)}}class I extends k{constructor(t){super(),this._value=t}get value(){return this._value}set(t){this._value=t,this.emit(this._value)}update(t){this._value=t(this._value),this.emit(this._value)}silentUpdate(t){this._value=t(this._value)}}const w={options:"ya-options",soundEnabled:"ya-soundEnabled",lastUrl:"ya-lastUrl"};class _{static save(t,n){localStorage.setItem(w[t],JSON.stringify(n))}static load(t){const n=localStorage.getItem(w[t]);return n?JSON.parse(n):null}static remove(t){localStorage.removeItem(w[t])}}const S="options";class B extends I{idCounter=f;constructor(){super(_.load("options")??[]);const t=this.value.length>0?this.value.reduce((n,e)=>Math.max(n,e.id),f):f-1;this.idCounter=t+1,this.subscribe(n=>_.save(S,n))}addOption(t){const n={id:this.idCounter++,...t};this.update(e=>[...e,n])}updateOption(t,n){this.silentUpdate(e=>e.map(s=>s.id===t?{...s,...n}:s)),_.save(S,this.value)}removeOption(t){this.update(n=>n.filter(e=>e.id!==t)),this.value.length===0&&(this.idCounter=f)}reset(){this.idCounter=f,this.set([])}}const r=new B;class v extends d{timeoutId=null;lastValue="";constructor(t){super({tag:"li",classNames:[C.option]}),this.render(t)}render(t){const n=new d({tag:"span",classNames:[C.id],text:t.id.toString()}),e=new x({type:"text",name:"title",attributes:{placeholder:"Title"},id:t.id.toString()});e.setValue(t.title);const s=a=>m=>{m!==this.lastValue&&(this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{r.updateOption(t.id,{[a]:m}),this.lastValue=m},200))};e.addListener("input",()=>{const a=e.getValue();t.title!==a&&s("title")(a)});const i=new x({type:"number",name:"weight",attributes:{placeholder:"Weight",min:"0"}});i.setValue(t.weight.toString()),i.addListener("input",()=>{const a=Number(i.getValue());t.weight!==a&&s("weight")(a)});const u=new c({text:"Delete",callback:()=>{this.deleteElement(),r.removeOption(t.id)}});this.appendChildren(n,e,i,u)}}const A="_modal_1cx89_5",T="_container_1cx89_12",V="_form_1cx89_22",R="_warning_1cx89_28",U="_button_1cx89_43",j="_textarea_1cx89_57",p={modal:A,container:T,form:V,warning:R,button:U,"modal-button":"_modal-button_1cx89_48","buttons-container":"_buttons-container_1cx89_52",textarea:j};class N extends d{blockScroll;unblockScroll;constructor(){super({tag:"dialog",classNames:[p.modal]}),this.blockScroll=()=>{document.body.classList.add("no-scroll")},this.unblockScroll=()=>{document.body.classList.remove("no-scroll")},this.addListener("click",t=>{t.target===this.node&&this.close()})}open(){document.body.append(this.node),this.blockScroll(),this.node.showModal()}close(){this.node.close(),this.unblockScroll(),this.deleteElement()}render(){const t=new d({tag:"div",classNames:[p.container]});return this.appendChildren(t),t}}const M=`Paste a list of new options in a CSV-like format:

title,1                 -> | title                 | 1 |
title with whitespace,2 -> | title with whitespace | 2 |
title , with , commas,3 -> | title , with , commas | 3 |
title with &quot;quotes&quot;,4   -> | title with &quot;quotes&quot;   | 4 |`,P=`Please add at least 2 valid options.

An option is considered valid if its title is not empty and its weight is greater than 0.`;class q extends N{constructor(){super(),this.renderContent()}renderContent(){const t=new d({tag:"p",text:P,classNames:[p.warning]}),n=new c({classNames:[p.button],text:"Close",callback:()=>{this.close()}});this.render().appendChildren(t,n)}}function F(o){return o.split(`
`)}function J(o){return o.map(e=>{const s=e.lastIndexOf(",");return s===-1?[e]:[e.slice(0,s),e.slice(s+1)]}).filter(e=>W(e)).map(([e,s])=>[e.trim(),Number(s.trim())]).filter(([e,s])=>typeof s=="number"&&!Number.isNaN(s)&&s>0?e&&s%1===0:!1)}function W(o){return o.length===2}function G(o=[]){for(const[t,n]of o)r.addOption({title:t,weight:n});console.log(o)}class K extends N{constructor(){super(),this.renderContent()}renderContent(){const t=new d({tag:"form",classNames:[p.form]});this.render().appendChildren(t);const e=new d({tag:"textarea",classNames:[p.textarea],attributes:{rows:"12",cols:"64",name:"table",placeholder:M}}),s=new d({tag:"div",classNames:[p["buttons-container"]]}),i=new c({text:"Cancel",callback:a=>{a.preventDefault(),this.close()},classNames:[p["modal-button"]]}),u=new c({text:"Confirm",callback:a=>{this.onConfirm(a,e.node.value)},classNames:[p["modal-button"]]});s.appendChildren(i,u),t.appendChildren(e,s)}onConfirm(t,n){t.preventDefault(),this.close();const e=F(n);if(e.length===0)return;const s=J(e);console.log(s),s.length!==0&&G(s)}}function Y(o){return o.filter(n=>n.title!==""&&n.weight!==0).length>1}function $(o,t){const n=JSON.stringify(o,null,2),e=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(e),i=document.createElement("a");i.href=s,i.download=t,document.body.append(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}function D(o){const t=document.createElement("input");t.type="file",t.accept="application/json",t.addEventListener("change",n=>{const e=n.target;if(!e.files||e.files.length===0)return;e.files[0].text().then(i=>{try{const u=JSON.parse(i);o(u)}catch(u){console.error("Error loading JSON:",u)}}).catch(i=>{console.error("Error reading file:",i)})}),t.click()}class X extends d{constructor(){super({tag:"main",classNames:[O.optionsPage]});const t=new d({tag:"ul",classNames:[O.options]});this.sub(r.subscribe(l=>{t.deleteChildren(),l.forEach(b=>{const g=new v(b);t.appendChildren(g)})}));const n=r.value;n.length>0&&n.forEach(l=>{const b=new v(l);t.appendChildren(b)});const e=new c({text:"Add Option",callback:()=>{r.addOption({title:"",weight:0})},classNames:[h["control-button"]]});this.sub(r.subscribe(l=>{t.deleteChildren(),l.forEach(b=>{const g=new v(b);t.appendChildren(g)})}));const s=new c({text:"Paste List",callback:()=>{new K().open()},classNames:[h["control-button"]]}),i=new c({text:"Clear List",callback:()=>{t.deleteChildren(),r.reset()},classNames:[h["control-button"]]}),u=new c({text:"Save List to File",callback:()=>{const l=r.value;$(l,"options.json")},classNames:[h["control-button"]]}),a=new c({text:"Load List from File",callback:()=>{D(l=>{r.set(l)})},classNames:[h["control-button"]]}),m=new c({text:"Start",callback:()=>{Y(r.value)?(globalThis.location.hash="/wheel",this.unsubscribeAll()):new q().open()},classNames:[h["control-button"]]});this.appendChildren(E,t,e,s,i,u,a,m)}}export{X as OptionsPage};
