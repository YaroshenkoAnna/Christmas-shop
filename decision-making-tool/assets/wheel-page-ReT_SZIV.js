import{B as d}from"./index-DR6X-6wH.js";import{O as _,S as w,I as y,D as g,o as T,t as E,M as S}from"./option-store-BBs9xifT.js";import{B as b}from"./button-wDCv07BZ.js";const M="_container_ocjbn_7",B="_back_ocjbn_36",D="_sound_ocjbn_40",N="_start_ocjbn_44",k="_disabled_ocjbn_48",a={"wheel-page":"_wheel-page_ocjbn_1",container:M,"wheel-result":"_wheel-result_ocjbn_8",back:B,sound:D,start:N,disabled:k};function A(i,t){let e;return(...s)=>{e!==void 0&&clearTimeout(e),e=setTimeout(()=>{i(...s)},t)}}const v="soundDisabled";class O{soundDisabled=new _(w.load(v)??!0);sounds=[];constructor(){this.soundDisabled.subscribe(t=>{w.save(v,t),this.handleSoundState(t)}),this.handleSoundState(this.soundDisabled.value)}toggleSound(){this.soundDisabled.set(!this.soundDisabled.value)}registerSound(t){this.sounds.push(t),t.muted=this.soundDisabled.value}handleSoundState(t){this.sounds.forEach(e=>{e.muted=t,e.volume=t?0:1})}}const m=new O;function C(i,t){const e=Math.ceil(i),s=Math.floor(t);return Math.floor(Math.random()*(s-e+1))+e}function I(){const i=[];for(let n=0;n<3;n++)i.push(C(100,255));const[t,e,s]=i;return`rgb(${t}, ${e}, ${s})`}function j(i){const t=[...i];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}const P="_wheel_1q71f_1",W={wheel:P};class F extends d{context;options;constructor(t){super({tag:"canvas",classNames:[W.wheel]}),this.node.width=500,this.node.height=500;const e=this.node.getContext("2d");if(!e)throw new Error("Failed to get 2D context");this.options=j(t.filter(s=>s.weight>0&&s.title)),this.context=e,this.render()}render(){this.drawSegments(),this.drawCenter()}drawSegments(){const t=this.options.length,e=this.options.reduce((n,o)=>n+o.weight,0);let s=0;for(let n=0;n<t;n++){const o=s;console.log("Begin",s);const l=o+2*Math.PI/e*this.options[n].weight;s=l,console.log("End",s),this.context.beginPath(),this.context.moveTo(250,250),this.context.arc(250,250,200,o,l),this.context.lineTo(250,250),this.context.fillStyle=I(),this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke(),this.drawSegmentText(this.options[n].title,o,l)}}drawCenter(){this.context.beginPath(),this.context.arc(250,250,25,0,2*Math.PI),this.context.fillStyle="rgb(0, 92, 138)",this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke()}drawSegmentText(t,e,s){const o=(e+s)/2,l=250+120*Math.cos(o),h=250+120*Math.sin(o),x=(s-e)*200/Math.PI;this.context.font="16px Arial",this.context.fillStyle="rgb(0, 0, 0)",this.context.textAlign="center",this.context.textBaseline="middle";const u=this.context.measureText(t);if(u.actualBoundingBoxAscent+u.actualBoundingBoxDescent>x)return;const p=120;let c=t;for(;this.context.measureText(c).width>p;)c=c.slice(0,-1);c.length<t.length&&(c+="..."),this.context.save(),this.context.translate(l,h),this.context.rotate(o),this.context.fillText(c,0,0),this.context.restore()}}class H extends d{victorySound=new Audio("victory.mp3");interactiveElements=[];constructor(){super({tag:"main",classNames:[a["wheel-page"]]}),m.registerSound(this.victorySound);const t=new b({text:"Back to Options",callback:()=>{globalThis.location.hash="/"},classNames:[a.back]}),e=new b({text:m.soundDisabled.value?"Sound: Off":"Sound: On",callback:()=>{m.toggleSound()},classNames:[a.sound]});m.soundDisabled.subscribe(r=>{e.setText(r?"Sound: Off":"Sound: On")});const s=new y({type:"number",name:"time",attributes:{min:"0",max:"30"},id:"Time",classNames:[a.time]});s.setValue(g.toString()),s.addListener("input",A(r=>{const c=r.target,f=Number(c.value);f<g?s.setValue(g.toString()):f>S&&s.setValue(S.toString())},1e3));const n=Number(s.getValue()),o=new b({text:"Start",callback:()=>{this.disable(),setTimeout(()=>{this.enable(),this.victorySound.play().catch(r=>{console.error("Failed to play victory sound:",r)})},n*1e3)},classNames:[a.start]}),l=new d({tag:"span",text:"Time",classNames:[a.span]}),h=new d({tag:"div",classNames:[a.container]});h.appendChildren(l,s);const x=new d({tag:"p",classNames:[a["wheel-result"]],text:"Press Start"}),u=new F(T.value);this.appendChildren(E,t,e,h,o,x,u),this.interactiveElements=[s,o,t,e,h]}disable(){this.interactiveElements.forEach(t=>{t.setAttributes({disabled:"true"}),t.addClasses([a.disabled])})}enable(){this.interactiveElements.forEach(t=>{t.removeAttribute("disabled"),t.removeClasses([a.disabled])})}}export{H as WheelPage};
