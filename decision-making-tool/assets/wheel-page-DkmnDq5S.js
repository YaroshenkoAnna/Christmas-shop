import{B as g}from"./index-BT9xA_vY.js";import{O as _,S as w,I as M,D as x,o as T,t as A,M as S}from"./option-store-BEaMhyDu.js";import{B as p}from"./button-BNMyFhtG.js";const I="_container_1o75q_7",y="_back_1o75q_36",k="_sound_1o75q_40",C="_start_1o75q_44",E="_disabled_1o75q_48",P="_picked_1o75q_53",r={"wheel-page":"_wheel-page_1o75q_1",container:I,"wheel-result":"_wheel-result_1o75q_8",back:y,sound:k,start:C,disabled:E,picked:P};function B(h,t){let e;return(...s)=>{e!==void 0&&clearTimeout(e),e=setTimeout(()=>{h(...s)},t)}}const v="soundDisabled";class N{soundDisabled=new _(w.load(v)??!0);sounds=[];constructor(){this.soundDisabled.subscribe(t=>{w.save(v,t),this.handleSoundState(t)}),this.handleSoundState(this.soundDisabled.value)}toggleSound(){this.soundDisabled.set(!this.soundDisabled.value)}registerSound(t){this.sounds.push(t),t.muted=this.soundDisabled.value}handleSoundState(t){this.sounds.forEach(e=>{e.muted=t,e.volume=t?0:1})}}const m=new N;function D(h,t){const e=Math.ceil(h),s=Math.floor(t);return Math.floor(Math.random()*(s-e+1))+e}function O(){const h=[];for(let n=0;n<3;n++)h.push(D(100,255));const[t,e,s]=h;return`rgb(${t}, ${e}, ${s})`}function q(h){const t=[...h];for(let e=t.length-1;e>0;e--){const s=Math.floor(Math.random()*(e+1));[t[e],t[s]]=[t[s],t[e]]}return t}const W="_wheel_1q71f_1",F={wheel:W};class R extends g{context;options;rotationAngle=0;isSpinning=!1;segmentColors;onSegmentChange;lastSegmentIndex=null;constructor(t,e){super({tag:"canvas",classNames:[F.wheel]}),this.node.width=500,this.node.height=500;const s=this.node.getContext("2d");if(!s)throw new Error("Failed to get 2D context");this.onSegmentChange=e,this.options=q(t.filter(n=>n.weight>0&&n.title)),this.context=s,this.segmentColors=this.options.map(()=>O()),this.clearCanvas(),this.render()}spinWheel(t){if(this.isSpinning)return;this.isSpinning=!0;const e=this.rotationAngle,s=performance.now(),n=e+Math.PI*2*t+Math.PI*2*Math.random(),o=a=>a===0?0:a===1?1:a<.5?Math.pow(2,20*a-10)/2:(2-Math.pow(2,-20*a+10))/2,i=a=>{const u=(a-s)/1e3,l=Math.min(u/t,1);this.rotationAngle=e+(n-e)*o(l),this.render(),l<1?setTimeout(()=>requestAnimationFrame(i),1e3/35):this.isSpinning=!1};requestAnimationFrame(i)}render(){this.context.save(),this.clearCanvas(),this.context.translate(250,250),this.context.rotate(this.rotationAngle),this.context.translate(-250,-250),this.drawSegments(),this.drawCenter(),this.context.restore(),this.drawArrow();const t=this.getSegmentIndexByArrow();if(t!==null&&t!==this.lastSegmentIndex){const e=this.options[t].title;this.onSegmentChange&&this.onSegmentChange(e),this.lastSegmentIndex=t}}drawSegments(){const t=this.options.length,e=this.options.reduce((n,o)=>n+o.weight,0);let s=0;for(let n=0;n<t;n++){const o=s,i=o+2*Math.PI/e*this.options[n].weight;s=i,this.context.beginPath(),this.context.moveTo(250,250),this.context.arc(250,250,200,o,i),this.context.lineTo(250,250),this.context.fillStyle=this.segmentColors[n],this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke(),this.drawSegmentText(this.options[n].title,o,i)}}drawCenter(){this.context.beginPath(),this.context.arc(250,250,25,0,2*Math.PI),this.context.fillStyle="rgba(0, 92, 138)",this.context.fill(),this.context.lineWidth=1,this.context.strokeStyle="rgb(0, 0, 0)",this.context.stroke(),this.context.beginPath(),this.context.arc(250,250,23,0,2*Math.PI),this.context.lineWidth=3,this.context.strokeStyle="rgb(241, 212, 212)",this.context.stroke()}drawSegmentText(t,e,s){const o=(e+s)/2,i=250+110*Math.cos(o),a=250+110*Math.sin(o),u=(s-e)*200/Math.PI;this.context.font="16px Arial",this.context.fillStyle="rgb(0, 0, 0)",this.context.textAlign="center",this.context.textBaseline="middle";const l=this.context.measureText(t);if(l.actualBoundingBoxAscent+l.actualBoundingBoxDescent>u)return;const b=140;let d=t;for(;this.context.measureText(d).width>b;)d=d.slice(0,-1);d.length<t.length&&(d+="..."),this.context.save(),this.context.translate(i,a),this.context.rotate(o),this.context.fillText(d,0,0),this.context.restore()}clearCanvas(){this.context.clearRect(0,0,this.node.width,this.node.height)}drawArrow(){this.context.save(),this.context.shadowColor="rgba(0, 0, 0, 0.5)",this.context.shadowOffsetX=2,this.context.shadowOffsetY=2,this.context.beginPath(),this.context.moveTo(250,70),this.context.lineTo(240,30),this.context.lineTo(260,30),this.context.lineTo(250,70),this.context.fillStyle="rgb(186, 186, 186)",this.context.strokeStyle="rgb(0, 0, 0)",this.context.fill(),this.context.stroke(),this.context.restore()}getSegmentIndexByArrow(){let t=Math.PI/2-this.rotationAngle+Math.PI;t=(t+2*Math.PI*100)%(2*Math.PI),t<0&&(t+=2*Math.PI);let e=0;const s=this.options.reduce((n,o)=>n+o.weight,0);for(let n=0;n<this.options.length;n++){const o=e,i=o+2*Math.PI/s*this.options[n].weight;if(t>=o&&t<=i)return n;e=i}return null}}class L extends g{victorySound=new Audio("victory.mp3");interactiveElements=[];constructor(){super({tag:"main",classNames:[r["wheel-page"]]}),m.registerSound(this.victorySound);const t=new p({text:"Back to Options",callback:()=>{globalThis.location.hash="/"},classNames:[r.back]}),e=new p({text:m.soundDisabled.value?"Sound: Off":"Sound: On",callback:()=>{m.toggleSound()},classNames:[r.sound]});m.soundDisabled.subscribe(c=>{e.setText(c?"Sound: Off":"Sound: On")});const s=new M({type:"number",name:"time",attributes:{min:"0",max:"30"},id:"Time",classNames:[r.time]});s.setValue(x.toString()),s.addListener("input",B(c=>{const d=c.target,f=Number(d.value);f<x?s.setValue(x.toString()):f>S&&s.setValue(S.toString())},1e3));const n=Number(s.getValue()),o=new g({tag:"p",classNames:[r["wheel-result"]]}),i=new R(T.value,c=>{o.setText(`${c}`)});o.setText("press start to spin the wheel");const a=new p({text:"Start",callback:()=>{this.disable(),o.removeClasses([r.picked]),i.spinWheel(Number(s.getValue())),setTimeout(()=>{this.enable(),o.addClasses([r.picked]),this.victorySound.play().catch(c=>{console.error("Failed to play victory sound:",c)})},n*1e3)},classNames:[r.start]}),u=new g({tag:"span",text:"Time",classNames:[r.span]}),l=new g({tag:"div",classNames:[r.container]});l.appendChildren(u,s),this.appendChildren(A,t,e,l,a,o,i),this.interactiveElements=[s,a,t,e,l]}disable(){this.interactiveElements.forEach(t=>{t.setAttributes({disabled:"true"}),t.addClasses([r.disabled])})}enable(){this.interactiveElements.forEach(t=>{t.removeAttribute("disabled"),t.removeClasses([r.disabled])})}}export{L as WheelPage};
