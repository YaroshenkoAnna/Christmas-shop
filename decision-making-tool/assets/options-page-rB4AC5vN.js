import{B as c,b as h}from"./button-CB28grw2.js";import{B as d}from"./index-BkueeJaQ.js";import{I as w,o as a,S as x,t as L}from"./option-store-DuoUBMBC.js";const S="_options_1aopn_1",_={options:S},v="_option_26su7_1",C={option:v};class g extends d{timeoutId=null;lastValue="";constructor(t){super({tag:"li",classNames:[C.option]}),this.render(t)}render(t){const s=new d({tag:"span",classNames:[C.id],text:t.id.toString()}),e=new w({type:"text",name:"title",attributes:{placeholder:"Title"},id:t.id.toString()});e.setValue(t.title);const n=i=>m=>{m!==this.lastValue&&(this.timeoutId&&clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{a.updateOption(t.id,{[i]:m}),this.lastValue=m},200))};e.addListener("input",()=>{const i=e.getValue();t.title!==i&&n("title")(i)});const l=new w({type:"number",name:"weight",attributes:{placeholder:"Weight",min:"0"}});l.setValue(t.weight.toString()),l.addListener("input",()=>{const i=Number(l.getValue());t.weight!==i&&n("weight")(i)});const u=new c({text:"Delete",callback:()=>{this.deleteElement(),a.removeOption(t.id)}});this.appendChildren(s,e,l,u)}}const y="_modal_1cx89_5",k="_container_1cx89_12",E="_form_1cx89_22",I="_warning_1cx89_28",B="_button_1cx89_43",V="_textarea_1cx89_57",p={modal:y,container:k,form:E,warning:I,button:B,"modal-button":"_modal-button_1cx89_48","buttons-container":"_buttons-container_1cx89_52",textarea:V};class N extends d{blockScroll;unblockScroll;constructor(){super({tag:"dialog",classNames:[p.modal]}),this.blockScroll=()=>{document.body.classList.add("no-scroll")},this.unblockScroll=()=>{document.body.classList.remove("no-scroll")},this.addListener("click",t=>{t.target===this.node&&this.close()})}open(){document.body.append(this.node),this.blockScroll(),this.node.showModal()}close(){this.node.close(),this.unblockScroll(),this.deleteElement()}render(){const t=new d({tag:"div",classNames:[p.container]});return this.appendChildren(t),t}}const A=`Paste a list of new options in a CSV-like format:

title,1                 -> | title                 | 1 |
title with whitespace,2 -> | title with whitespace | 2 |
title , with , commas,3 -> | title , with , commas | 3 |
title with &quot;quotes&quot;,4   -> | title with &quot;quotes&quot;   | 4 |`,T=`Please add at least 2 valid options.

An option is considered valid if its title is not empty and its weight is greater than 0.`;class R extends N{constructor(){super(),this.renderContent()}renderContent(){const t=new d({tag:"p",text:T,classNames:[p.warning]}),s=new c({classNames:[p.button],text:"Close",callback:()=>{this.close()}});this.render().appendChildren(t,s)}}function j(o){return o.split(`
`)}function P(o){return o.map(e=>{const n=e.lastIndexOf(",");return n===-1?[e]:[e.slice(0,n),e.slice(n+1)]}).filter(e=>q(e)).map(([e,n])=>[e.trim(),Number(n.trim())]).filter(([e,n])=>typeof n=="number"&&!Number.isNaN(n)&&n>0?e&&n%1===0:!1)}function q(o){return o.length===2}function M(o=[]){for(const[t,s]of o)a.addOption({title:t,weight:s});console.log(o)}class F extends N{constructor(){super(),this.renderContent()}renderContent(){const t=new d({tag:"form",classNames:[p.form]});this.render().appendChildren(t);const e=new d({tag:"textarea",classNames:[p.textarea],attributes:{rows:"12",cols:"64",name:"table",placeholder:A}}),n=new d({tag:"div",classNames:[p["buttons-container"]]}),l=new c({text:"Cancel",callback:i=>{i.preventDefault(),this.close()},classNames:[p["modal-button"]]}),u=new c({text:"Confirm",callback:i=>{this.onConfirm(i,e.node.value)},classNames:[p["modal-button"]]});n.appendChildren(l,u),t.appendChildren(e,n)}onConfirm(t,s){t.preventDefault(),this.close();const e=j(s);if(e.length===0)return;const n=P(e);console.log(n),n.length!==0&&M(n)}}function U(o){return o.filter(s=>s.title!==""&&s.weight!==0).length>1}function W(o,t){const s=JSON.stringify(o,null,2),e=new Blob([s],{type:"application/json"}),n=URL.createObjectURL(e),l=document.createElement("a");l.href=n,l.download=t,document.body.append(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(n)}function J(o){const t=document.createElement("input");t.type="file",t.accept="application/json",t.addEventListener("change",s=>{const e=s.target;if(!e.files||e.files.length===0)return;e.files[0].text().then(l=>{try{const u=JSON.parse(l);o(u)}catch(u){console.error("Error loading JSON:",u)}}).catch(l=>{console.error("Error reading file:",l)})}),t.click()}class z extends d{constructor(){super({tag:"main",classNames:[_.optionsPage]});const t=new d({tag:"ul",classNames:[_.options]}),s=x.load("optionsCleared");console.log(s,a.value.length),a.value.length===0&&!s&&a.addOption({title:"",weight:1}),this.sub(a.subscribe(r=>{t.deleteChildren(),r.forEach(b=>{const f=new g(b);t.appendChildren(f)})}));const e=a.value;e.length>0&&e.forEach(r=>{const b=new g(r);t.appendChildren(b)});const n=new c({text:"Add Option",callback:()=>{a.addOption({title:"",weight:0})},classNames:[h["control-button"]]});this.sub(a.subscribe(r=>{t.deleteChildren(),r.forEach(b=>{const f=new g(b);t.appendChildren(f)})}));const l=new c({text:"Paste List",callback:()=>{new F().open()},classNames:[h["control-button"]]}),u=new c({text:"Clear List",callback:()=>{x.save("optionsCleared",!0),t.deleteChildren(),a.reset()},classNames:[h["control-button"]]}),i=new c({text:"Save List to File",callback:()=>{const r=a.value;W(r,"options.json")},classNames:[h["control-button"]]}),m=new c({text:"Load List from File",callback:()=>{J(r=>{a.set(r)})},classNames:[h["control-button"]]}),O=new c({text:"Start",callback:()=>{U(a.value)?(globalThis.location.hash="/wheel",this.unsubscribeAll()):new R().open()},classNames:[h["control-button"]]});this.appendChildren(L,t,n,l,u,i,m,O)}}export{z as OptionsPage};
